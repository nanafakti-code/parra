---
interface Props {
    product: {
        id: string;
        name: string;
        slug: string;
        price: number;
        compare_price?: number | null;
        image: string;
        stock: number;
        is_featured?: boolean;
        categories?: { name: string; slug: string } | null;
    };
    index?: number;
}

const { product, index = 0 } = Astro.props;
const category = product.categories?.name || "Guantes";
const hasDiscount =
    product.compare_price && product.compare_price > product.price;
const discountPercent = hasDiscount
    ? Math.round(
          ((product.compare_price! - product.price) / product.compare_price!) *
              100,
      )
    : 0;
---

<article
    class="card-product opacity-0 animate-fade-up"
    style={`animation-delay: ${index * 0.1}s;`}
>
    <!-- Image Container -->
    <a
        href={`/product/${product.slug}`}
        class="block aspect-[3/4] overflow-hidden bg-surface-900 relative"
    >
        <img
            src={product.image}
            alt={product.name}
            loading="lazy"
            class="w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-110"
        />

        <!-- Badges -->
        <div class="absolute top-4 left-4 flex flex-col gap-2 z-10">
            {product.is_featured && <span class="badge-pro">PRO</span>}
            {hasDiscount && <span class="badge-sale">-{discountPercent}%</span>}
            {
                product.stock < 5 && product.stock > 0 && (
                    <span class="badge bg-red-600 text-white">Últimas</span>
                )
            }
        </div>

        <!-- Hover Overlay -->
        <div
            class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500 flex items-end justify-center pb-6"
        >
            <div class="flex gap-3">
                <span class="btn-primary !py-3 !px-6 !text-xs">
                    <svg
                        class="w-4 h-4 mr-1.5 inline-block"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                        ></path>
                    </svg>
                    Añadir
                </span>
                <a
                    href={`/product/${product.slug}`}
                    class="btn-outline !py-3 !px-4 !text-xs !border"
                >
                    <svg
                        class="w-4 h-4"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                        ></path>
                    </svg>
                </a>
            </div>
        </div>
    </a>

    <!-- Info -->
    <div class="p-5">
        <div class="flex justify-between items-start mb-1.5">
            <span
                class="text-[10px] font-bold text-brand uppercase tracking-[0.2em]"
            >
                {category}
            </span>
        </div>
        <a href={`/product/${product.slug}`}>
            <h3
                class="font-display text-base font-semibold uppercase tracking-tight group-hover:text-brand transition-colors duration-300 mb-2"
            >
                {product.name}
            </h3>
        </a>
        <div class="flex items-center gap-3">
            <span class="text-lg font-bold text-white"
                >€{product.price.toFixed(2)}</span
            >
            {
                hasDiscount && (
                    <span class="text-sm text-white/30 line-through">
                        €{product.compare_price!.toFixed(2)}
                    </span>
                )
            }
        </div>
    </div>
</article>
