---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import ProductCard from "../components/ProductCard.astro";
import Benefits from "../components/Benefits.astro";
import GloveSelector from "../components/GloveSelector.astro";
import Testimonials from "../components/Testimonials.astro";
import Newsletter from "../components/Newsletter.astro";
import Footer from "../components/Footer.astro";
import { supabase } from "../lib/supabase";

let products: any[] = [];
try {
	const { data } = await supabase
		.from("products")
		.select("*, categories(name, slug)")
		.eq("is_featured", true)
		.eq("is_active", true)
		.order("created_at", { ascending: false })
		.limit(4);
	products = data || [];
} catch (e) {
	console.error("Supabase error index:", e);
}
---

<Layout
	title="Inicio"
	description="PARRA — Guantes de portero profesionales. Agarre extremo, tecnología alemana, diseño premium."
>
	<Header />
	<main>
		<!-- Hero -->
		<Hero />

		<!-- Featured Products -->
		<section class="section bg-surface-950">
			<div class="container">
				<div
					class="flex flex-col md:flex-row justify-between items-start md:items-end mb-14 gap-6"
				>
					<div>
						<h2 class="section-title">
							Productos <span class="text-brand">Destacados</span>
						</h2>
						<p class="section-subtitle">
							Nuestra selección de los guantes más vendidos.
							Tecnología de vanguardia para porteros exigentes.
						</p>
					</div>
					<a href="/shop" class="btn-outline group shrink-0">
						Ver toda la tienda
						<svg
							class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
						</svg>
					</a>
				</div>

				<div
					class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8"
				>
					{
						(products || []).map((product: any, i: number) => (
							<ProductCard product={product} index={i} />
						))
					}
				</div>
			</div>
		</section>

		<!-- Benefits -->
		<Benefits />

		<!-- Glove Selector -->
		<GloveSelector />

		<!-- Testimonials -->
		<Testimonials />

		<!-- CTA Banner -->
		<section
			class="relative h-[50vh] md:h-[60vh] flex items-center overflow-hidden"
		>
			<div
				class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1543326727-cf6c39e8f84c?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-fixed bg-center"
			>
				<div class="absolute inset-0 bg-black/70"></div>
			</div>
			<div class="container relative z-10 text-center">
				<h2
					class="text-5xl md:text-7xl lg:text-8xl font-display font-bold uppercase tracking-tighter mb-8"
				>
					¿LISTO PARA<br />
					<span class="text-brand">VOLAR?</span>
				</h2>
				<a href="/register" class="btn-glow inline-flex">
					Únete al Club PARRA
					<svg
						class="w-4 h-4 ml-2"
						fill="none"
						stroke="currentColor"
						viewBox="0 0 24 24"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							stroke-width="2"
							d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
					</svg>
				</a>
			</div>
		</section>

		<!-- Newsletter -->
		<Newsletter />
	</main>
	<Footer />
</Layout>
